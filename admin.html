<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Painel Administrativo</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm" id="btnLogoutAdmin">Sair</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h4>Gerenciar Inquilinos</h4>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalNovoInquilino">
                            Adicionar Inquilino
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>CPF</th>
                                        <th>Casa</th>
                                        <th>Aluguel</th>
                                        <th>Água</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaInquilinos">
                                    <!-- Dados serão preenchidos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Pagamentos Pendentes</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Inquilino</th>
                                        <th>Casa</th>
                                        <th>Mês/Ano</th>
                                        <th>Método</th>
                                        <th>Data Solicitação</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabelaPendentes">
                                    <!-- Dados serão preenchidos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Inquilino -->
    <div class="modal fade" id="modalNovoInquilino" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Inquilino</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formNovoInquilino">
                        <div class="mb-3">
                            <label for="nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="nome" required>
                        </div>
                        <div class="mb-3">
                            <label for="cpf" class="form-label">CPF</label>
                            <input type="text" class="form-control" id="cpf" required>
                        </div>
                        <div class="mb-3">
                            <label for="senha" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="senha" required>
                        </div>
                        <div class="mb-3">
                            <label for="casa" class="form-label">Casa</label>
                            <select class="form-select" id="casa" required>
                                <option value="">Selecione a casa</option>
                                <option value="casa3">Casa 3</option>
                                <option value="casa3-101">Casa 3/101</option>
                                <option value="casa4">Casa 4</option>
                                <option value="casa4-101">Casa 4/101</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="aluguel" class="form-label">Valor do Aluguel</label>
                            <input type="number" class="form-control" id="aluguel" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="agua" class="form-label">Valor da Água</label>
                            <input type="number" class="form-control" id="agua" step="0.01" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnSalvarInquilino">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- SCRIPT DE PROTEÇÃO DA PÁGINA (COLOCAR AQUI) -->
    <script>
        // admin-auth-check.js - Proteção da página admin
        document.addEventListener('DOMContentLoaded', async function() {
            // Inicializar Firebase (use a mesma configuração do auth.js)
            const firebaseConfig = {
                apiKey: "sua-api-key",
                authDomain: "seu-projeto.firebaseapp.com",
                databaseURL: "https://seu-projeto.firebaseio.com",
                projectId: "seu-projeto",
                storageBucket: "seu-projeto.appspot.com",
                messagingSenderId: "seu-sender-id",
                appId: "seu-app-id"
            };
            
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }

            // Função para verificar se é admin
            async function checkIfAdmin(uid) {
                try {
                    const snapshot = await firebase.database().ref('administradores/' + uid).once('value');
                    return snapshot.exists();
                } catch (error) {
                    console.error("Erro ao verificar admin:", error);
                    return false;
                }
            }

            // Verificar autenticação
            async function checkAuth() {
                const adminAuth = localStorage.getItem('adminAuth');
                const adminUID = localStorage.getItem('adminUID');
                
                if (adminAuth && adminUID) {
                    const isAdmin = await checkIfAdmin(adminUID);
                    if (isAdmin) {
                        return true;
                    }
                }
                
                return false;
            }

            // Verificar se está autenticado como admin
            const isAuthenticated = await checkAuth();
            
            if (!isAuthenticated) {
                alert('Acesso não autorizado. Redirecionando para login...');
                window.location.href = 'admin-login.html';
                return;
            }
            
            // Se autenticado, configurar o botão de logout
            document.getElementById('btnLogoutAdmin').addEventListener('click', function() {
                firebase.auth().signOut();
                localStorage.removeItem('adminAuth');
                localStorage.removeItem('adminUID');
                window.location.href = 'admin-login.html';
            });
            
            console.log('Admin autenticado. Carregando conteúdo...');
        });
    </script>

    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>